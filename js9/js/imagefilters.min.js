var ImageFilters;
ImageFilters=function(){function m(d,a,b,c){var e,h,g,f,j,r,l,p,q,u,k,n,m=Math.round(Math.sqrt(a.length)),v=Math.floor(m/2),s=d.data,t=d.width,x=d.height,y=d.data;if("[object Array]"!==Object.prototype.toString.call(a))return d;void 0===b&&(b=!0);b=b?1:0;if(c){e=a.reduce(function(a,b){return a+b});for(c=0;c<a.length;++c)a[c]/=e}for(e=0;e<x;e++)for(c=0;c<t;c++){g=e;h=c;r=4*(e*t+c);for(p=n=k=u=q=0;p<m;p++)for(l=0;l<m;l++)j=Math.min(x-1,Math.max(0,g+p-v)),f=Math.min(t-1,Math.max(0,h+l-v)),f=4*(j*t+f),
j=a[p*m+l],q+=s[f]*j,u+=s[f+1]*j,k+=s[f+2]*j,n+=s[f+3]*j;y[r]=q;y[r+1]=u;y[r+2]=k;y[r+3]=n+b*(255-n)}return d}function w(d,a,b){var c,e,h,g,f,j,r,l,p,q,m,k,n=Math.round(Math.sqrt(a.length)),w=Math.floor(n/2),v=d.data,s=d.width;d=d.height;var t=new Float32Array(4*s*d),x=b?1:0;for(c=0;c<d;c++)for(b=0;b<s;b++){h=c;e=b;j=4*(c*s+b);for(l=k=m=q=p=0;l<n;l++)for(r=0;r<n;r++)f=Math.min(d-1,Math.max(0,h+l-w)),g=Math.min(s-1,Math.max(0,e+r-w)),g=4*(f*s+g),f=a[l*n+r],p+=v[g]*f,q+=v[g+1]*f,m+=v[g+2]*f,k+=v[g+
3]*f;t[j]=p;t[j+1]=q;t[j+2]=m;t[j+3]=k+x*(255-k)}return t}function z(d){var a,b,c=d.data;for(a=0;a<c.length;a+=4)b=0.299*c[a]+0.587*c[a+1]+0.114*c[a+2],c[a]=c[a+1]=c[a+2]=b;return d}function A(d){var a,b,c=d.data;for(a=0;a<c.length;a+=4)b=(c[a]+c[a+1]+c[a+2])/3,c[a]=c[a+1]=c[a+2]=b;return d}return{convolve:m,luminance:function(d){var a,b,c=d.data;for(a=0;a<c.length;a+=4)b=0.2126*c[a]+0.7152*c[a+1]+0.0722*c[a+2],c[a]=c[a+1]=c[a+2]=b;return d},greyscale:z,greyscaleAvg:A,brighten:function(d,a){var b,
c=d.data;a=a||10;for(b=0;b<c.length;b+=4)c[b]+=a,c[b+1]+=a,c[b+2]+=a;return d},noise:function(d,a,b){var c,e,h,g=d.data;2>arguments.length&&(a=-30,b=30);e=b-a;for(c=0;c<g.length;c+=4)h=Math.floor(Math.random()*e-b),g[c]+=h,g[c+1]+=h,g[c+2]+=h;return d},duotone:function(d,a){var b,c,e=d.data;switch(a){case "r":a=0;break;case "g":a=1;break;case "b":a=2;break;default:a=0}for(b=0;b<e.length;b+=4)c=(e[b]+e[b+1]+e[b+2]-e[b+a])/2,e[b+a]=c;return d},invert:function(d){var a,b=d.data;for(a=0;a<b.length;a+=
4)b[a]=255-b[a],b[a+1]=255-b[a+1],b[a+2]=255-b[a+2];return d},pixelate:function(d,a){var b,c,e,h,g,f,j,m,l,p,q=d.width,u=d.height,k=d.data;2>arguments.length&&(a=2);p=2*a;for(j=a;j<u-a;j+=p)for(f=a;f<q-a;f+=p){e=4*(q*j+f);b=k[e];c=k[e+1];e=k[e+2];for(l=-a;l<a;++l){g=q*(j+l);for(m=-a;m<a;++m)h=4*(g+(f+m)),k[h]=b,k[h+1]=c,k[h+2]=e}}return d},sobel:function(d,a){var b,c,e,h,g,f=d.data;d=A(d);g=w(d,[-1,0,1,-2,0,2,-1,0,1]);h=w(d,[-1,-2,-1,0,0,0,1,2,1]);if(a)for(b=0;b<f.length;b+=4)c=Math.abs(h[b]),e=Math.abs(g[b]),
f[b]=c,f[b+1]=e,f[b+2]=(c+e)/4;else{for(b=0;b<f.length;b+=4)c=Math.abs(h[b]),e=Math.abs(g[b]),f[b]=c,f[b+1]=e,f[b+2]=(c+e)/2;z(d)}return d},medianFilter:function(d){return m(d,[1,0,0,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,1,0,1,0,0,0,1],!0,!0)},sepia:function(d){var a,b,c,e,h=d.data;for(a=0;a<h.length;a+=4)b=h[a],c=h[a+1],e=h[a+2],h[a]=0.393*b+0.769*c+0.189*e,h[a+1]=0.349*b+0.686*c+0.168*e,h[a+2]=0.272*b+0.534*c+0.131*e;return d},contrast:function(d,a){var b,c=d.data;2>arguments.length&&(a=2);-100>a?a=-100:
100<a&&(a=100);for(b=0;b<c.length;b+=4)c[b]=255*((c[b]/255-0.5)*a+0.5),c[b+1]=255*((c[b+1]/255-0.5)*a+0.5),c[b+2]=255*((c[b+2]/255-0.5)*a+0.5);return d},threshold:function(d,a,b,c){var e,h,g,f,j=d.data;2>arguments.length?(a=10,b=0,c=255):4>arguments.length&&(b=0,c=255);for(e=0;e<j.length-1;e+=4)h=j[e],g=j[e+1],f=j[e+2],h=0.2126*h+0.7152*g+0.0722*f>=a?c:b,j[e]=j[e+1]=j[e+2]=h;return d},gamma:function(d,a){var b,c=d.data;2>arguments.length&&(a=0.2);for(b=0;b<c.length;b+=4)c[b]=255*Math.pow(c[b]/255,
a),c[b+1]=255*Math.pow(c[b+1]/255,a),c[b+2]=255*Math.pow(c[b+2]/255,a);return d},gaussBlur5:function(d){return m(d,[0.003,0.0133,0.0219,0.0133,0.003,0.0133,0.0596,0.0983,0.0596,0.0133,0.0219,0.0983,0.1621,0.0983,0.0219,0.0133,0.0596,0.0983,0.0596,0.0133,0.003,0.0133,0.0219,0.0133,0.003])},posterize:function(d,a){var b,c,e,h,g=[];c=1;var f=d.data;2>arguments.length&&(a=40);for(b=0;256>b;++b)b<a*c?g[b]=a*(c-1):(g[b]=a*c,++c);for(b=0;b<f.length;b+=4)c=f[b],e=f[b+1],h=f[b+2],f[b]=g[c],f[b+1]=g[e],f[b+
2]=g[h];return d},scatter:function(d,a){var b,c,e,h,g,f,j,m,l,p,q=d.width,u=d.height,k=d.data;2>arguments.length&&(a=5);g=2*a;f=(a-1)*a;for(c=a;c<u-a;c+=g)for(b=a;b<q-a;b+=g){e=!1;for(h=0;!e;){j=Math.floor(Math.random()*g-a);m=Math.floor(Math.random()*g-a);l=Math.floor(Math.random()*g-a);p=Math.floor(Math.random()*g-a);var n=[];j=4*(q*(m+c)+(j+b));l=4*(q*(p+c)+(l+b));n[0]=k[j];n[1]=k[j+1];n[2]=k[j+2];n[3]=k[j+3];k[j]=k[l];k[j+1]=k[l+1];k[j+2]=k[l+2];k[j+3]=k[l+3];k[l]=n[0];k[l+1]=n[1];k[l+2]=n[2];
k[l+3]=n[3];++h;h>f&&(e=!0)}}return d},solarize:function(d,a){var b,c,e,h,g,f=d.data;2>arguments.length&&(a=50);for(b=0;b<f.length;++b)c=f[b],e=f[b+1],h=f[b+2],g=(c+e+h)/3,g<a&&(f[b]=255-c,f[b+1]=255-e,f[b+2]=255-h);return d},sharpen:function(d,a){2>arguments.length&&(a=20);return m(d,[0,-3,0,-3,a,-3,0,-3,0],!0,!0)},edgeDetect:function(d){return m(d,[-1,-1,-1,-1,8,-1,-1,-1,-1])},blur:function(d){return m(d,[1,2,1,2,1,2,1,2,1],!0,!0)},emboss:function(d,a){2>arguments.length&&(a=95);return m(d,[-18,
-9,9,-9,100-a,9,0,9,18],!0,!0)},lighten:function(d,a){if(2>arguments.length||0>a)a=12/9;return m(d,[0,0,0,0,a,0,0,0,0])},darken:function(d,a){if(2>arguments.length||1<a)a=6/9;return m(d,[0,0,0,0,a,0,0,0,0])}}}();
